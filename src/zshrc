platform='unknown'
unamestr=`uname`
if [[ "$unamestr" == 'Linux' ]]; then
   platform='linux'
elif [[ "$unamestr" == 'FreeBSD' ]]; then
   platform='freebsd'
elif [[ "$unamestr" == 'Darwin' ]]; then
   platform='osx'
fi

export LANG=en_US.UTF-8

export PATH="/usr/local/sbin:/usr/local/bin:$HOME/bin:$PATH"

ulimit -n 4096
BLOCKSIZE=K;	export BLOCKSIZE
VISUAL=vi;    export VISUAL
set -o vi
PAGER=more; export PAGER
EDITOR=vim; export EDITOR

alias sz='source ~/.zshrc'
alias uvim='vim -u NONE'

alias k='kubectl'
alias kctx='kubectx'
alias dockerrm='docker rm $(docker ps -a -q)'
alias dockerstop='docker stop $(docker ps -a -q)'
alias dockerkill='docker kill $(docker ps -a -q)'
alias dockerrmi='docker rmi $(docker images -q)'
alias dockerrmif='docker rmi -f $(docker images -q)'
alias dockeruntagged='docker rmi $(docker images | grep "^<none>" | awk "{print $3}")'
alias dockerdangle='docker rmi $(docker images -q --filter dangling=true)'
alias dockerk8s='rm -f ~/.kube/config && cp ~/.kube/config_docker-for-desktop ~/.kube/config'

alias fetchupstream='git fetch upstream'
alias mergeupstream='git merge upstream/master'

export TERM="screen-256color"
export GIT_EDITOR="vim -f"

SAVEHIST=1000
HISTFILE=~/.zsh_history

setopt APPEND_HISTORY

if [[ $platform == 'linux' ]]; then
  export JAVA_HOME=$(dirname $(dirname $(readlink -f /usr/bin/java)))/..
elif [[ $platform == 'osx' ]]; then
  export CLICOLOR=1
  export LSCOLORS=GxFxCxDxBxegedabagaced
  export JAVA_HOME="$(/usr/libexec/java_home)"
  export PATH="$PATH:/usr/local/texlive/2016/bin/x86_64-darwin"
fi 

# fix ^M issue in sbt interactive mode
stty icrnl

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
#[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion


#
# Custom Cloud Theme with insane git prompt (really, I just want separate dirty and untracked indicators)
#

if [[ -z $ZSH_THEME_CLOUD_PREFIX ]]; then
    ZSH_THEME_CLOUD_PREFIX='☁'
fi

PROMPT_PRE=''
if [[ $platform == 'linux' ]]; then
  PROMPT_PRE='%n@%m'
else
  # see instructions at https://github.com/olivierverdier/zsh-git-prompt
  GIT_PROMPT_EXECUTABLE="haskell"
fi

source ~/tmp/zsh-git-prompt/zshrc.sh
PROMPT='${PROMPT_PRE}%{$fg_bold[cyan]%}$ZSH_THEME_CLOUD_PREFIX %{$fg[green]%}%p %{$fg[green]%}%c %{$fg[cyan]%}$(git_super_status)%{$fg_bold[blue]%}% %{$reset_color%}'

ZSH_THEME_GIT_PROMPT_PREFIX="%{$fg_bold[cyan]%}["
ZSH_THEME_GIT_PROMPT_SUFFIX="%{$fg_bold[cyan]%}] "

ZSH_THEME_GIT_PROMPT_SEPARATOR=""
ZSH_THEME_GIT_PROMPT_BRANCH="%{$fg[green]%}"
ZSH_THEME_GIT_PROMPT_STAGED="%{$fg[blue]%}%{ ●%G%}"
ZSH_THEME_GIT_PROMPT_CONFLICTS="%{$fg[red]%}%{ ✖%G%}"
ZSH_THEME_GIT_PROMPT_CHANGED="%{$fg[gray]%}%{ ✚%G%}"
ZSH_THEME_GIT_PROMPT_BEHIND="%{ ↓%G%}"
ZSH_THEME_GIT_PROMPT_AHEAD="%{ ↑%G%}"
ZSH_THEME_GIT_PROMPT_UNTRACKED="%{$fg_bold[red]%}%{ …%G%}"
ZSH_THEME_GIT_PROMPT_CLEAN=""

alias iexvi='rlwrap -a foo iex'
alias fixz='source $HOME/.zshrc_local'

export GOPATH=~/go

export ZPLUG_HOME=/usr/local/opt/zplug
source $ZPLUG_HOME/init.zsh

zplug "zsh-users/zsh-history-substring-search"
zplug "caarlos0/git-add-remote"
# zplug "plugins/git",   from:oh-my-zsh
# zplug "plugins/mix",   from:oh-my-zsh
zplug "plugins/cargo",   from:oh-my-zsh
zplug "plugins/vi-mode",   from:oh-my-zsh
# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
        echo; zplug install
    fi
fi

# Then, source plugins and add commands to $PATH
zplug load

autoload -U +X bashcompinit; bashcompinit
eval "$(register-python-argcomplete az)"

source $HOME/.cargo/env

if [ -f ~/.zshrc_local ]; then
  . ~/.zshrc_local
fi

