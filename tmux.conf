#######################################################################
## customized for navicore on osx                                    ##
## brew install tmux                                                 ##
## brew install reattach-to-user-namespace                           ##
## psot install run:                                                 ##
## git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm ##
## ~/.tmux/plugins/tpm/bin/install_plugins                           ##
#######################################################################
set-option -g focus-events on

set-option -sa terminal-overrides ",xterm*:Tc"

set-option -a terminal-features 'screen-256color:RGB'

set-option -g default-shell /bin/zsh
set -g default-shell /bin/zsh
set-option -g default-command zsh
set -g default-command zsh

#stop tmux window title changes
DISABLE_AUTO_TITLE=true

#set -g mouse-utf8 on
set -g mouse on
bind -n WheelUpPane   select-pane -t= \; copy-mode -e \; send-keys -M
bind -n WheelDownPane select-pane -t= \;                 send-keys -M

set -g status-keys vi
setw -g mode-keys vi

# prefix key
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# experimental custom stuff
set -s escape-time 1
set -g base-index 1
set -g pane-base-index 1

set-option -g allow-rename off

# Use the OS X pasteboard hack if available
if 'command -v reattach-to-user-namespace >/dev/null' \
  'set -gq @osx-pasteboard true'

if -F '#{@osx-pasteboard}' \
  'set -g default-command "reattach-to-user-namespace -l $SHELL"'

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
#bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"
bind-key -T copy-mode-vi C-h select-pane -L
bind-key -T copy-mode-vi C-j select-pane -D
bind-key -T copy-mode-vi C-k select-pane -U
bind-key -T copy-mode-vi C-l select-pane -R
#bind-key -T copy-mode-vi C-\ select-pane -l

set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins/'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'sainnhe/tmux-fzf'

# set vi-mode
set-window-option -g mode-keys vi
# keybindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

set-option -g default-shell $SHELL

bind '%' split-window -h -c '#{pane_current_path}'  # Split panes horizontal
bind '"' split-window -v -c '#{pane_current_path}'  # Split panes vertically

# Nightfox colors for Tmux
# Style: nightfox
# Upstream: https://github.com/edeneast/nightfox.nvim/raw/main/extra/nightfox/nightfox_tmux.tmux
set -g mode-style "fg=#131a24,bg=#aeafb0"
set -g message-style "fg=#131a24,bg=#aeafb0"
set -g message-command-style "fg=#131a24,bg=#aeafb0"
set -g pane-border-style "fg=#aeafb0"
set -g pane-active-border-style "fg=#719cd6"
set -g status "on"
set -g status-justify "left"
set -g status-style "fg=#aeafb0,bg=#131a24"
set -g status-left-length "100"
set -g status-right-length "100"
set -g status-left-style NONE
set -g status-right-style NONE
set -g status-left "#[fg=#131a24,bg=#719cd6,bold] #S #[fg=#719cd6,bg=#131a24,nobold,nounderscore,noitalics]"
set -g status-right "#[fg=#131a24,bg=#131a24,nobold,nounderscore,noitalics]#[fg=#719cd6,bg=#131a24] #{prefix_highlight} #([ -d "$HOME/git/navicore/zet" ] && ~/.local/share/nvim/lazy/nvim-reminders/scripts/tmux-reminders.sh $HOME/git/$(whoami)/zet)#(~/naviscripts/bin/navinote-hourly-sync.sh)#[fg=#71839b,bg=#131a24,nobold]#[range=user|term] Term #[norange]#[fg=#aeafb0,bg=#131a24,nobold,nounderscore,noitalics]#[fg=#131a24,bg=#aeafb0] %Y-%m-%d  %I:%M %p #[fg=#719cd6,bg=#aeafb0,nobold,nounderscore,noitalics]#[fg=#131a24,bg=#719cd6,bold] #h "

# support for nvim-reminders, zett, and term tmux popups
bind r run-shell '$HOME/.local/share/nvim/lazy/nvim-reminders/scripts/tmux-reminder-popup.sh'
bind z run-shell '$HOME/.local/share/nvim/lazy/nvim-reminders/scripts/tmux-zett-popup.sh'
bind t run-shell '$HOME/naviscripts/bin/tmux-term-popup.sh'
bind -Troot MouseDown1Status if -F '#{==:#{mouse_status_range},reminder}' \
  'run-shell "$HOME/.local/share/nvim/lazy/nvim-reminders/scripts/tmux-reminder-popup.sh"' \
  'if -F "#{==:#{mouse_status_range},zett}" "run-shell $HOME/.local/share/nvim/lazy/nvim-reminders/scripts/tmux-zett-popup.sh" \
    "if -F \"#{==:#{mouse_status_range},term}\" \"run-shell $HOME/naviscripts/bin/tmux-term-popup.sh\" \"select-window -t =\""'

setw -g window-status-activity-style "underscore,fg=#71839b,bg=#131a24"
setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=#71839b,bg=#131a24"
setw -g window-status-format "#[fg=#131a24,bg=#131a24,nobold,nounderscore,noitalics]#[default] #I  #W #F #[fg=#131a24,bg=#131a24,nobold,nounderscore,noitalics]"
setw -g window-status-current-format "#[fg=#131a24,bg=#aeafb0,nobold,nounderscore,noitalics]#[fg=#131a24,bg=#aeafb0,bold] #I  #W #F #[fg=#aeafb0,bg=#131a24,nobold,nounderscore,noitalics]"

# Use the system clipboard for tmux copy-paste operations
# Requires `reattach-to-user-namespace` on macOS
# Use xclip or xsel on Linux

# For macOS
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode y send-keys -X copy-pipe-and-cancel "pbcopy"

#start resurrect

# Auto-restore session on tmux start
set -g @continuum-restore 'on'

# Optional: auto-save every 15 minutes (default), can change interval
set -g @continuum-save-interval '15'

# Optional: auto-start tmux when terminal opens (macOS)
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'iterm'  # or 'fullscreen' for Terminal.app

#end resurrect

# For Linux (assuming xclip is installed)
# bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -in"
# bind -T copy-mode y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -in"

run '~/.tmux/plugins/tpm/tpm'

set -g default-terminal "xterm-ghostty"

# allow-passthrough requires tmux 3.3a+
if-shell 'tmux -V | grep -qE "tmux (3\.[3-9]|[4-9])"' 'set -g allow-passthrough on'

set -g status-interval 60 
